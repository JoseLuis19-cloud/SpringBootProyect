<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
	<head>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/webjars/org.webjars/bootstrap/4.5.3/css/bootstrap.min.css">
	<link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.5.3/css/bootstrap.min.css}" />

  	<script th:src="@{/webjars/jquery/3.5.1/jquery.min.js}"></script>
	<script th:src="@{/webjars/popper.js/1.14.3/umd/popper.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/4.5.3/js/bootstrap.min.js}"></script>
	
  <style> 
 
   .form-control-xs {
    height: calc(1em + .375rem + 2px) !important;
    padding: .125rem .25rem !important;
    font-size: .75rem !important;
    line-height: 1.5;
    border-radius: .2rem;
	}
	
	h3 {
  		font-weight: bold !important;
  		color: #495057 !important;
  		font-size: 30px !important;
  		
  		border-bottom: 2px solid #000 !important;
 		background:#e9ecef !important;
  		color:#003B49 !important;

  		display:inline-block !important;
  		padding:8px 20px !important;
 		margin-left:10px !important;
		}
		
	h5 {
  		color: #F2A900 !important;
  		font-size: 26px !important;
  		
 		background:#e9ecef !important;
  		color:#F2A900 !important;

  		display:inline-block !important;
  		padding:3px 15px !important;
 		margin-left:10px !important;
		}
  </style>	
		
	<script th:inline="javascript">
		
		var arrValueCheck = null;
		var arrValueCheckASupr  = null;
	 	var idMenuSelec = "";

		$(document).ready(function() {
			 $('[name="checks[]"]').click(function() {
			     arrValueCheck = $('[name="checks[]"]:checked').map(function(){
			     return this.value;
			 }).get();
			      
			  alert(arrValueCheck);
			 if (arrValueCheck.length > 9)
			    {
			    alert("Se pueden elegir hasta 9 elementos de menu para añadir o suprimir");
			    }
			     
			  // var str = arrValueCheck.join(',');
			  //  $('#arr').text(JSON.stringify(arr));
			  //  $('#str').text(str);
			  });
			  
			  $('[name="checksSubMenuUsu[]"]').click(function() {
				  arrValueCheckASupr = $('[name="checksSubMenuUsu[]"]:checked').map(function(){
			      return this.value;
			    }).get();
				  
				  
				 alert("pinchados : " + arrValueCheckASupr);
				  
				  if (arrValueCheckASupr.length > 9)
			     	{
			    	 alert("Se pueden elegir hasta 9 elementos de menu para añadir o suprimir");
			        }
			  });
			 
			 $("#idLinkAnadirTodos").click(function() {
				$("input[id^='idCheckActivado']").prop("checked", true);
				document.getElementById("idP3").style.display = "block";	
				$("#idAccionHidden").val("anadirtodos");
				$("#myModalConfirm").modal();
			  });
			 
			 $("#idLinkConfirmar").click(function() {
				    alert("boton confirmar");
				  });

			});
		
		function anadirElemenSubMenuUsu()
	  	 {
			if (arrValueCheck == null)
				{
				 alert("Debe seleccionar al menos un elemento a añadir"); 
				 return;
				}
			 else
			  {
				if (arrValueCheck.length == 0)
					{
					 alert("Debe seleccionar al menos un elemento a añadir");
					 return;
					}
				else
					{
					 document.getElementById("idP1").style.display = "block";

					 var ind = 0;
					 for (var i=0; i < arrValueCheck.length; i++)
				 	 	{
						 alert(arrValueCheck[i]);
					  	 $("#idIdSubMenuHidden" + ind).val(arrValueCheck[i]);
					     alert("Ha elegido: " + $("#idIdSubMenuHidden" + ind).val());
					  	 ind++;
				 	 	// idMenuSelec = arrValueCheck[i];
			   	     	}
					 	$("#idAccionHidden").val("anadiruno");  
						$("#myModalConfirm").modal();
					}
				
				//	for (var i=0; i<arrValueCheck.length; i++)
				//	 {
				//	  idMenuSelec = arrValueCheck[i];
			   	//   }
			  }
	  	 }
		
		function eliminarElemenSubMenuUsu()
	  	 {
			if (arrValueCheckASupr == null)
				{
				 alert("Debe seleccionar al menos un elemento a suprimir"); 
				}
			 else
			  {
				if (arrValueCheckASupr.length == 0)
					{
					 alert("Debe seleccionar al menos un elemento a suprimir");
					}
				else
					{
 					document.getElementById("idP2").style.display = "block";
					 
					 var ind = 0;
					 for (var i=0; i<arrValueCheckASupr.length; i++)
				 	  { 
					   	$("#idIdSubMenuHidden" + ind).val(arrValueCheckASupr[i]);
					//   	alert("Seleccionado: " + "i: " + i + ", " + $("#idMenuUsuHidden" + ind).val());
					   	$("#idIdSubMenuUsuHidden" + ind).val($("#idSubMenuUsuSelHidden" + i).val());
					   	alert("alert: " + $("#idIdSubMenuUsuHidden" + ind).val() );
					  	ind++;
				 	 // idMenuSelec = arrValueCheck[i];
			   	      }
					$("#idAccionHidden").val("suprimiruno");  
					$("#myModalConfirm").modal();
					}
			    	//	for (var i=0; i<arrValueCheckASupr.length; i++)
					// {
					//	idMenuSelecSuprimir = arrValueCheckASupr[i];
			   	 	// }
	  			}
		}

		function anadirElemento(objElemen, ind)
	  	 {  
		  alert(objElemen.checked);
		  alert(ind);
		  alert("buenas: " + document.getElementById("idSubMenuUsuSelHidden"+ind).value);
		  
		  if (objElemen.checked)
			 {
			 document.getElementById("idIdSubMenuUsuHidden"+indExp).value = document.getElementById("idSubMenuUsuSelHidden"+ind).value;
		//	 alert(document.getElementById("idIdMenuUsuHidden"+indExp).value);
			 indExp = indExp + 1;
			 }
			else
			{
			 document.getElementById("idIdSubMenuUsuHidden"+indExp).value = "";
		//	 alert(document.getElementById("idIdMenuUsuHidden"+indExp).value);
			 iindExp = indExp - 1;
			}
	  	 }
		
		function confirmarSubMenuUsuario()
	  	 {
	  // Submitir formulario
		 document.getElementById("idFormSubMenuUsuario").submit();
	  	 }
	</script>

</head>

  <body>
  
   <div th:insert="Aplicacion/fragments/BotoneraMenuCabecera2 :: menucabecera"></div>
	
	<div class="container-fluid">

		<div class="row">
			<div class="col-1"></div>
 			 <div class="col-10"><h3 th:text="'Gestión de elementos submenus del menu: ' + ${nomMenuPrincipal} + ' para el usuario: ' + ${nomUsuario}"></h3></div>
			<div class="col-1"></div>
		</div>
																				
		<form th:id="idFormSubMenuUsuario" th:action="@{/gestionmenususuario/actualizarsubmenuusuario}" th:object="${beanCamposGesMenuUsu}" method="post">		
			<input type="hidden" th:id="'idAccionHidden'" 	th:name="'accionHidden'"    th:field="*{idAccion}" />
			<input type="hidden" th:id="'IdIdUsuario'" 		th:name="'idUsuario'"       th:field="*{idUsuario}" />
			<input type="hidden" th:id="'idNomUsuario'" 	th:name="'nomUsuario'"      th:field="*{nomUsuario}" />
			<input type="hidden" th:id="'idMenuPrincipal'" 	th:name="'idMenuPrincipal'" th:field="*{idMenuPrincipal}" />

		 	<input type="hidden" th:id="'idIdSubMenuHidden0'"  th:name="'idSubMenuHidden0'"  th:field="*{idMenu1}" />
		 	<input type="hidden" th:id="'idIdSubMenuHidden1'"  th:name="'idSubMenuHidden1'"  th:field="*{idMenu2}" />
		 	<input type="hidden" th:id="'idIdSubMenuHidden2'"  th:name="'idSubMenuHidden2'"  th:field="*{idMenu3}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden3'"  th:name="'idSubMenuHidden3'"  th:field="*{idMenu4}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden4'"  th:name="'idSubMenuHidden4'"  th:field="*{idMenu5}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden5'"  th:name="'idSubMenuHidden5'"  th:field="*{idMenu6}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden6'"  th:name="'idSubMenuHidden6'"  th:field="*{idMenu7}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden7'"  th:name="'idSubMenuHidden7'"  th:field="*{idMenu8}" />	
		 	<input type="hidden" th:id="'idIdSubMenuHidden8'"  th:name="'idSubMenuHidden8'"  th:field="*{idMenu9}" />	
		 	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden0'"  th:name="'idSubMenuUsuHidden0'"  th:field="*{idMenuUsu1}" />
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden1'"  th:name="'idSubMenuUsuHidden1'"  th:field="*{idMenuUsu2}" />
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden2'"  th:name="'idSubMenuUsuHidden2'"  th:field="*{idMenuUsu3}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden3'"  th:name="'idSubMenuUsuHidden3'"  th:field="*{idMenuUsu4}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden4'"  th:name="'idSubMenuUsuHidden4'"  th:field="*{idMenuUsu5}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden5'"  th:name="'idSubMenuUsuHidden5'"  th:field="*{idMenuUsu6}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden6'"  th:name="'idSubMenuUsuHidden6'"  th:field="*{idMenuUsu7}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden7'"  th:name="'idSubMenuUsuHidden7'"  th:field="*{idMenuUsu8}" />	
		 	<input type="hidden" th:id="'idIdSubMenuUsuHidden8'"  th:name="'idSubMenuUsuHidden8'"  th:field="*{idMenuUsu9}" />						
		</form> 
		
		<div class="row">
			<div class="col-1"></div>
  			<div class="col-4">
  				<h5 th:text="'Elementos del submenú ya activas:'"></h5>
  				<div id="idDivSubMenu1Usu">
					<div th:insert="gestionMenus/fragments/SubMenusSelecUsuario :: submenuselecusuario"></div>
				</div>	
			</div>
 			<div class="col-2" style="text-align: center">
 				<div class="btn-group-vertical" role="group" aria-label="Vertical button group">
 					<br/>
 					<br/>
 					<br/>
				 	<a th:id="'idLinkAnadir'"   th:name="'linkAnadir'"  th:onclick="th:anadirElemenSubMenuUsu()"  class="btn btn-primary btn-sm" role="button"> < Añadir</a>
				 	<br/>
					<a th:id="'idLinkSuprimir'" th:name="'linkSuprimir'" th:onclick="th:eliminarElemenSubMenuUsu()" class="btn btn-primary btn-sm" role="button">Suprimir ></a>
					<br/>
					<a th:id="'idLinkAnadirTodos'" th:name="'linkAnadirTodos'"  class="btn btn-primary btn-sm" role="button"> < Añadir todos</a>
					<br/>
				</div>
 			</div>
 			<div class="col-4">
 				<h5 th:text="'Opciones del submenu disponibles'"></h5>
 				<div th:insert="gestionMenus/fragments/SubMenusAplicaDispUsuario :: submenuapliselecusuario"></div>
 			</div>
 			<div class="col-1"></div>
		</div>
		
		<div class="row" style="border-top: 2px solid #000">
			<div class="col-1"></div>
 			 <div class="col-10"> 
 			   <p th:id="'idPMensaje'"> Los cambios en la asignación de menus se verán reflejados la próxima vez que entre el usuario a la apliciación</p>
  			   <a th:id="'idVolver'" th:href="@{/gestionmenususuario/obtenermenusuario(idUsuario=*{beanCamposGesMenuUsu.idUsuario}, nomUsuario=${nomUsuario} )}" class="btn btn-primary" role="button">Volver</a>
 			 </div>
 			 
 			<div class="col-1"></div>
 		</div>
		
   </div>
   
    <!-- Modal Confirmación -->
  	<div id="myModalConfirm" class="modal" tabindex="-1" role="dialog">
 	 <div class="modal-dialog" role="document">
    	<div class="modal-content">
     	 <div class="modal-header">
       	 <h5 class="modal-title">Confirmación elementos menu</h5>
       	 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
       	   <span aria-hidden="true">&times;</span>
       	 </button>
      	</div>
     	 <div class="modal-body">
     	 	<p th:id="'idP1'" style="display:none;"> ¿Confirmar que quiere añadir los elementos de submenu seleccionados a submenu este usuario?.</p>
     	 	<p th:id="'idP2'" style="display:none;"> ¿Confirmar que quiere suprimir los elementos de submenu seleccionados a submenu este usuario?.</p>
      		<p th:id="'idP3'" style="display:none;"> ¿Confirmar que quiere añadir todos los elementos de submenu a este usuario?.</p>
      	</div>
     	 <div class="modal-footer">
      	   <button type="button" class="btn btn-primary" data-dismiss="modal">Cancelar</button>
     	   <button type="button" th:onclick="th:confirmarSubMenuUsuario()" class="btn btn-primary">Confirmar</button>
      	</div>
   	 </div>
  	</div>
	</div>
	 	
	</body>
</html>
